(ns clj-vat.algo-test
  #+cljs  (:require-macros [cemerick.cljs.test
                    :refer (is are deftest with-test run-tests testing test-var)])
  #+cljs (:require [cemerick.cljs.test :as t]
                   [clj-vat.algo :as a])
  #+clj (:use clojure.test)
  #+clj (:require [clj-vat.algo :as a]))


(deftest test-->digits
  (are [i r] (= r (a/->digits i))
       "12345" [1 2 3 4 5]
       ["1" "2" "3" "4"] [1 2 3 4]
       12345 [1 2 3 4 5]))


(deftest test-+>9
  (are [i r] (= (a/+>9 i) r)
       12 3
       9 9
       111 3
       10 1
       11 2
       0 0))


(deftest test-luhn
  (are [i r] (= (a/luhn i) r)
       "5136160214196774" true
       "5136160214196773" false))

(deftest test->num
  (are [i r] (= r (a/->num i))
       [1 2 3 4 ] 1234))

(deftest test-check-vat-fr
  (are [i] (true? (a/check-vat-fr i))
       "89753948272"
       "12402385876"
       "32392677282"
       "58449286426"
       "96343149944"
       "78418114351"
       "49450767322"
       "63351577002"
       "38413058439"
       "52453093965"
       "18306369943"
       "46542060132"
       "55352496624"
       "45334835766"
       "17440389831"
       "11349352419"))




(deftest test-check-vat-gb
  (are [i] (true? (a/check-vat-gb i))
       "339072747"
       "163597044"
       "103590836"
       "848243215"
       "288638008"
       "404065883"
       "795834568"
       "247103682"
       "947205321"
       "728520043"
       "553124860"
       "998718045"
       "825439027"
       "901232480"
       "724283637"
       "985134203"
       "947223711"
       "172351381"
       "929539969"
       "983190496"
       "304766951"
       "783419405"
       "770817808"
       "243208980"
       "555054253"
       "986200020"
       "226556555"
       "840722445"
       "557285804"
       "378038429"
       "825823911"
       "806607141"
       "979389434"
       "611635076"
       "763160441"
       "112452654"))


(deftest test-check-vat-dk
  (are [i](true? (a/check-vat-dk i))
       "13585628"
       "29425434"
       "3614921342" ;should fail
       "67679628"
       "30861310"
       "56423818"
       "26366313"
       "25922921"
       "17026518"
       "27998895"
       "10664446"
       "27224849"
       "25586840"
       "15027800"
       "29425434"))


(deftest test-check-vat-de
  (are [i] (= (a/check-vat-de i) true)
       "136695976"
       "148418567"
       "811152493"
       "813632841"
       "157336064"
       "125081842"
       "812227901"
       "183677859"
       "116213911"
       "121967016"
       "139233160"
       "146130661"
       "811152493"
       "148418567"
       "811152493"
       "813337219"
       "212532749"
       "149320417"
       "170179642"
       "223236969"
       "813821430"
       "812463252"
       "213388352"
       "811423486"
       "208317647"
       "157796279"
       "811698404"
       "811152493"
       "126957135"
       "812139660"
       "812803588"
       "117658764"
       "812761885"
       "131934331"
       "813851493"
       "251553271"
       "811152493"
       "117662628"
       "123045750"
       "189915799"))


 (deftest test-check-vat-pl
   (are [i] (= (a/check-vat-pl i) true)
        "7250013591"
        "5270022391"
        "5210089960"
        "5220103934"
        "5213405781"
        "1130017933"
        "5270104717"
        "5242388571"
        "1130017933"
        "6460000312"
        "8520000358"
        "8310003586"
        "5252109503"
        "1130039461"
        "7610002225"
        "1130017933"
        "5841031823"
        "5270103824"
        "1130017933"
        "7790002272"
        "6180017056"
        "7610002225"
        "6272494255"
        "5270022391"))



 (deftest test-check-vat-it
   (are [i] (= (a/check-vat-it i))
        "00743560153"
        "00004330544"
        "08102830018"
        "06015890012"
        "07047090159"
        "00891230153"
        "00009070285"
        "01231680156"
        "00537550261"
        "00416940476"
        "01656160692"
        "00524760246"
        "00004330544"
        "00656120367"
        "12345670785"))


 (deftest test-check-vat-pt
   (are [i] (= (a/check-vat-pt i) true)
        "503272337"
        "501721630"
        "506510441"
        "501745815"
        "500017921"
        "500731993"
        "506000478"
        "504406400"
        "500461481"
        "504158899"
        "501393749"
        "500076090"
        "136695973"
        "500095922"
        "500163510"
        "500306486"
        "500287600"
        "501698540"
        "500002614"
        "501578102"
        "500627126"
        "500313687"
        "500287058"
        "500287058"
        "501522220"
        "502025140"
        "500020639"
        "502025140"
        "500212848"
        "500218412"
        "503425206"
        "504218581"))


 (deftest test-check-vat-es
   (are [i] (= true (a/check-vat-es i))
        "A31126758"
        "B98328891"
        "B02367969"
        "A78084365"
        "B91194373"
        "A79326021"
        "A79326021"
        "A28110682"
        "B81096471"
        "B18849265"
        "B55059943"
        "B92964907"
        "F30144745"
        "B73135717"
        "B73135717"
        "B17807793"
        "B73094716"
        "B73094716"
        "B73468746"
        "A47060108"
        "B98059876"
        "A04344115"
        "B43118934"
        "B62948468"))


 (deftest test-check-vat-be
   (are [i] (= true (a/check-vat-be i))
        "136695962"
        "401296720"
        "404199394"
        "465288412"
        "432999288"
        "822752119"
        "437013209"
        "479540482"
        "478171891"))


 (deftest test-check-vat-hu
   (are [i] (true? (a/check-vat-hu i))
        "12631368"
        "10862508"
        "10896798"
        "10252435"
        "11832700"
        "12631368"
        "10813566"
        "10562112"
        "10210798"
        "13632142"
        "12644504"
        "11125633"))

 (deftest test-check-vat-nl
   (are [i] (true? (a/check-vat-nl i))
        "810617511B01"
        "006575651B03"
        "809203844B01"
        "001733540B01"
        "001266706B01"
        "803936631B01"
        "006942027B01"
        "808698746B01"
        "808286997B01"
        "806639556B01"
        "006918293B01"
        "807366845B01"
        "803936631B01"
        "006918293B01"
        "809096444B01"
        "006918293B01"
        "008225497B01"
        "005928862B01"
        "004201991B01"
        "002837110B01"
        "810411970B01"
        "817911510B01"
        "004193866B01"
        "807181845B01"
        "001236362B01"
        "002629744B01"
        "003813095B03"
        "810617511B01"
        "063235833B01"
        "801283929B04"
        "806763206B06"
        "004799975B01"
        "808248455B01"
        "810717360B01"
        "004297209B01"
        "006575651B03"
        "801283929B04"
        "806943476B01"
        "801283929B02"
        "006314193B02"
        "006991403B01"
        "004799975B01"
        "800583668B01"
        "001625123B01"
        "800669046B01"
        "811514274B01"
        "005467755B01"
        "006314193B06"
        "008165701B02"
        "006883011B01"
        "001524598B01"
        "005395732B01"
        "004799975B01"
        "006953608B01"
        "801283929B04"
        "001351746B01"
        "003590094B01"
        "006115391B01"
        "008740331B01"
        "800904965B05"
        "008867343801"
        "003528261B01"
        "005449960B03"
        "809203844B01"
        "002345742B01"
        "005799405B04"
        "009143488B01"
        "235270179801"
        "005652285B01"
        "001733540B01"
        "007294347B03"
        "006579425B01"
        "801880804B01"
        "004937338B01"
        "004327822B13"
        "004297234B05"
        "004059530B01"
        "004297234B01"
        "005824813B04"
        "009769304B01"
        "007063544B04"
        "801288794B01"
        "800366268B03"
        "806943476B01"
        "801427770801"
        "008709282B01"
        "001337476B01"
        "119965689B01"
        "009215232B01"
        "003203098B01"
        "807665538B01"
        "805695187B01"
        "004748906301"
        "007122998801"
        "009014251801"
        "007953525B01"
        "007772555B01"
        "811514274B01"
        "811514274B01"
        "811514274B01"
        "004799975B01"
        "805695187B01"
        "805356472B01"
        "005730065B01"
        "001337476B01"
        "008917437B03"
        "007156054B01"
        "806235093B01"
        "805356472B01"
        "800995004B01"
        "805695187B01"
        "001266706B01"
        "008187162B05"
        "806763206B06"
        "805695187B01"
        "005286177B02"
        "004407970B01"
        "803936631B01"
        "003590094B01"
        "004799975B01"
        "003360179B01" ))

 (deftest test-check-vat-se
   (are [i] (true? (a/check-vat-se i))
        "136695975523"))


 (deftest test-check-vat-el
   (are [i] (true? (a/check-vat-el i))
        "123456783"))

 (deftest test-check-vat-ie
   (are [i] (true? (a/check-vat-ie i))
        "6599525K"
        "4870800A"
        "6322073C"
        "8F47910T"
        "4574973H"
        "8F85560M"
        "9F69313D"
        "8F61758E"
        "4571931W"
        "4809539S"
        "6589960W"
        "6569740T"
        "4809539S"
        "9568085J"
        "6586063A"
        "6553007D"
        "4620030C"
        "8236506T"
        "4799334B"
        "0526750E"
        "4536860D"))


 (deftest test-check-vat-at
   (are [i] (true? (a/check-vat-at i))
        "U13585627"
        "U30164005"
        "U34260000"
        "U34699207"
        "U51025000"
        "U35613608"
        "U35613608"
        "U35613608"
        "U15393205"
        "U29074701"
        "U46153102"
        "U15301206"
        "U46234105"
        "U44463503"
        "U19208701"
        "U19208701"
        "U19208701"
        "U19208701"
        "U20785309"
        "U35613608"
        "U46234105"
        "U15383403"))


 (deftest test-check-vat-is
   (are [i] (true? (a/check-vat-is i))
        "23311347"
        "23191503"
        "64665020"
        "56405006"
        "18805477"
        "81959745"
        "77779517"
        "72161248"
        "16519949"
        "52690644"
        "46695966"))

 (deftest test-check-vat-fi
   (are [i] (true? (a/check-vat-fi i))
        "13669598"))

 (deftest test-check-vat-lu
   (are [i] (true? (a/check-vat-lu i))
        "17458960"
        "14492937"
        "11742635"
        "12192281"
        "13083505"
        "14492937"
        "16965218"
        "17458960"
        "18147908"
        "15959114"
        "15068003"
        "18329342"
        "15349155"
        "10522325"
        "18028257"
        "19803611"
        "19088973"
        "18668754"
        "17458960"
        "17458960"
        "14922662"
        "17044510"
        "18970647"
        "21623857"
        "16468636"))

 (deftest test-check-vat-lv
   (are [i] (true? (a/check-vat-lv i))
        "40003649404"))

(time
  (run-tests))



